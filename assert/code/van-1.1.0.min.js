let e,t,l,o,r,f=Object,n=f.getPrototypeOf,s=document,a={isConnected:1},i={},u=n(a),d=n(n),_=(e,t,l,o)=>(e??(setTimeout(l,o),new Set)).add(t),c=(e,t,o)=>{let r=l;l=t;try{return e(o)}catch(e){return console.error(e),o}finally{l=r}},g=e=>e.filter(e=>e.t?.isConnected),h=t=>r=_(r,t,()=>{for(let e of r)e.l=g(e.l),e.o=g(e.o);r=e},1e3),w={get val(){return l?.add(this),this.i},get oldVal(){return l?.add(this),this.u},set val(l){let o=this;if(l!==o.i){o.i=l;let r=[...o.o=g(o.o)];for(let t of r)y(t.f,t.s,t.t),t.t=e;o.l.length?t=_(t,o,m):o.u=l}}},v=e=>({__proto__:w,i:e,u:e,l:[],o:[]}),S=e=>n(e??0)===w,x=(e,t)=>{let l=new Set,r={f:e},f=o;o=[];let n=c(e,l,t);n=(n??s).nodeType?n:new Text(n);for(let e of l)h(e),e.l.push(r);for(let e of o)e.t=n;return o=f,r.t=n},y=(e,t=v(),l)=>{let r=new Set,f={f:e,s:t};f.t=l??o?.push(f)??a,t.val=c(e,r);for(let e of r)h(e),e.o.push(f);return t},V=(t,...l)=>{for(let o of l.flat(1/0)){let l=n(o??0),r=l===w?x(()=>o.val):l===d?x(o):o;r!=e&&t.append(r)}return t},b=t=>new Proxy((l,...o)=>{let[r,...a]=n(o[0]??0)===u?o:[{},...o],_=t?s.createElementNS(t,l):s.createElement(l);for(let[t,o]of f.entries(r)){let r=l=>l?f.getOwnPropertyDescriptor(l,t)??r(n(l)):e,s=l+","+t,a=i[s]??(i[s]=r(n(_))?.set??0),u=a?a.bind(_):_.setAttribute.bind(_,t),c=n(o??0);c===w?x(()=>(u(o.val),_)):c!==d||t.startsWith("on")&&!o.g?u(o):x(()=>(u(o()),_))}return V(_,...a)},{get:(t,l)=>t.bind(e,l)}),m=()=>{let l=[...t].filter(e=>e.i!==e.u);t=e;for(let t of new Set(l.flatMap(e=>e.l=g(e.l)))){let l=t.t,o=x(t.f,l);t.t=e,o!==l&&(o!=e?l.replaceWith(o):l.remove())}for(let e of l)e.u=e.i};export default{add:V,_:e=>(e.g=1,e),tags:b(),tagsNS:b,state:v,val:e=>S(e)?e.val:e,oldVal:e=>S(e)?e.oldVal:e,derive:y};